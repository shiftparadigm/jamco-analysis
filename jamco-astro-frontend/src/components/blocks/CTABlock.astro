---
import { urlFor } from '../../lib/sanity'
import Button from '../ui/Button.astro'

interface Props {
  heading: string
  subheading?: string
  ctaButton?: any
  backgroundColor?: string
  backgroundImage?: any
}

const {
  heading,
  subheading,
  ctaButton,
  backgroundColor = 'blue',
  backgroundImage
} = Astro.props

const bgImageUrl = backgroundImage ? urlFor(backgroundImage).width(1440).auto('format').url() : null

function getCtaHref(): string {
  if (!ctaButton) return '#'
  if (ctaButton.linkType === 'external' && ctaButton.externalUrl) return ctaButton.externalUrl
  if (ctaButton.internalLink?.slug) return `/${ctaButton.internalLink.slug}`
  return '#'
}
---

<section class={`cta-block bg-${backgroundColor}`}>
  {bgImageUrl && <div class="bg-image" style={`background-image: url(${bgImageUrl})`}></div>}
  <div class="cta-overlay"></div>

  <div class="cta-container">
    <h2>{heading}</h2>
    {subheading && <p class="subheading">{subheading}</p>}

    {ctaButton && (
      <Button
        href={getCtaHref()}
        text={ctaButton.text}
        variant="outline"
        target={ctaButton.linkType === 'external' ? '_blank' : undefined}
      />
    )}
  </div>
</section>

<style>
  .cta-block {
    position: relative;
    padding: var(--section-gap) 0;
    text-align: center;
    overflow: hidden;
  }

  .bg-image {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
  }

  .cta-overlay {
    position: absolute;
    inset: 0;
  }

  .bg-blue {
    background-color: var(--color-primary);
    color: var(--color-light);
  }

  .bg-blue .cta-overlay {
    background: rgba(0, 85, 172, 0.55);
  }

  .bg-dark-blue {
    background-color: var(--color-dark-bg);
    color: var(--color-light);
  }

  .bg-dark-blue .cta-overlay {
    background: linear-gradient(180deg, rgba(3, 35, 67, 0.9) 0%, rgba(3, 35, 67, 0.95) 100%);
  }

  .cta-container {
    position: relative;
    z-index: 1;
    max-width: 800px;
    margin: 0 auto;
    padding: 0 var(--spacing-md);
  }

  h2 {
    font-size: clamp(32px, 4vw, 52px);
    margin-bottom: 1rem;
    font-weight: var(--weight-semibold);
  }

  .subheading {
    font-size: 18px;
    line-height: 1.6;
    margin-bottom: 2rem;
    opacity: 0.9;
  }

  @media (max-width: 768px) {
    h2 {
      font-size: 32px;
    }

    .subheading {
      font-size: 16px;
    }
  }
</style>
